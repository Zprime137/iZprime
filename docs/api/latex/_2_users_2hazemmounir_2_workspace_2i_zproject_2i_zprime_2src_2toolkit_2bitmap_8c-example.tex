\doxysection{/\+\+Users/\+hazemmounir/\+\+Workspace/\+i\+Zproject/\+i\+Zprime/\+src/\+toolkit/\+bitmap.\+c}
\hypertarget{_2_users_2hazemmounir_2_workspace_2i_zproject_2i_zprime_2src_2toolkit_2bitmap_8c-example}{}\label{_2_users_2hazemmounir_2_workspace_2i_zproject_2i_zprime_2src_2toolkit_2bitmap_8c-example}Clears bits at regular intervals, typically used in sieve algorithms.

Clears bits at regular intervals, typically used in sieve algorithms.\+Starting from start\+\_\+idx, this function clears every step-\/th bit up to the specified limit (inclusive). This is commonly used in prime sieve algorithms where you need to mark all multiples of a number as composite.

The function includes:\+
\begin{DoxyItemize}
\item Automatic capping of limit to bitmap size
\item Integer overflow protection in the loop
\item Early termination to prevent infinite loops
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em bitmap} & Pointer to the bitmap to modify \\
\hline
{\em step} & Interval between bits to clear (must be \texorpdfstring{$>$}{>} 0, typically a prime) \\
\hline
{\em start\+\_\+idx} & Starting bit index (inclusive, typically first multiple) \\
\hline
{\em limit} & Upper bound for clearing (inclusive, auto-\/capped to size-\/1)\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
If limit \texorpdfstring{$>$}{>} bitmap-\/\texorpdfstring{$>$}{>}size, it is automatically reduced to bitmap-\/\texorpdfstring{$>$}{>}size -\/ 1 

No operation if bitmap is NULL, step is 0, or start\+\_\+idx \texorpdfstring{$>$}{>} limit 

Includes overflow prevention:\+ stops if next index would overflow
\end{DoxyNote}
/\+/\+ For Sieve of Eratosthenes:\+ mark multiples of 3 starting from 9 bitmap\+\_\+clear\+\_\+steps(bitmap, 3, 9, 1000); /\+/\+ Clears 9, 12, 15, 18, ...


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <\doxymbox{\hyperlink{bitmap_8h}{bitmap.h}}>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#ifdef\ \_\_aarch64\_\_}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <arm\_neon.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#elif\ defined(\_\_x86\_64\_\_)\ ||\ defined(\_M\_X64)}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <immintrin.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{}
\DoxyCodeLine{\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *\doxymbox{\hyperlink{group__iz__bitmap_ga165a40f31d911d8939771e064e2b87c1}{bitmap\_init}}(\textcolor{keywordtype}{size\_t}\ size,\ \textcolor{keywordtype}{int}\ set\_bits)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ assert(size\ >\ 0\ \&\&\ \textcolor{stringliteral}{"{}Bitmap\ size\ must\ be\ positive"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap\ =\ (\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *)malloc(\textcolor{keyword}{sizeof}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}));}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (bitmap\ ==\ NULL)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}Memory\ allocation\ failed\ for\ BITMAP\ struct"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aca2dd3fb24d74ee6b53ac400c83fe673}{size}}\ =\ size;}
\DoxyCodeLine{\ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}}\ =\ (size\ +\ 7)\ /\ 8;}
\DoxyCodeLine{\ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)malloc(bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}});}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}\ ==\ NULL)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ free(bitmap);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}bitmap\_create:\ Memory\ allocation\ failed\ for\ BITMAP"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (set\_bits)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ memset(bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}},\ 0xFF,\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}});}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ memset(bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}},\ 0x00,\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ memset(bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aae9a46b0b2a05387d54f18f780632bbe}{sha256}},\ 0,\ SHA256\_DIGEST\_LENGTH);\ \textcolor{comment}{//\ Initialize\ SHA-\/256\ to\ zero}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ bitmap;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{group__iz__bitmap_ga66cb254c9bf38d7adfe83d723baa2e15}{bitmap\_free}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ **bitmap)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Safe\ guard\ against\ double\ free\ and\ NULL\ pointer}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (bitmap\ \&\&\ *bitmap)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*bitmap)-\/>data)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ free((*bitmap)-\/>data);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ (*bitmap)-\/>data\ =\ NULL;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ free(*bitmap);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ *bitmap\ =\ NULL;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{group__iz__bitmap_gac4b86fad09a6d97932143a9f3e04a024}{bitmap\_set\_bit}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap,\ \textcolor{keywordtype}{size\_t}\ idx)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[idx\ /\ 8]\ |=\ (1\ <<\ (idx\ \%\ 8));}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ \doxymbox{\hyperlink{group__iz__bitmap_ga7a2c67bab864cee11a8ffcf2f5b6ce8f}{bitmap\_get\_bit}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap,\ \textcolor{keywordtype}{size\_t}\ idx)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ (bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[idx\ /\ 8]\ \&\ (1\ <<\ (idx\ \%\ 8)))\ !=\ 0;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{group__iz__bitmap_ga540e108d22ac9f423581ba6f4f6b8c03}{bitmap\_flip\_bit}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap,\ \textcolor{keywordtype}{size\_t}\ idx)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[idx\ /\ 8]\ \string^=\ (1\ <<\ (idx\ \%\ 8));}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{group__iz__bitmap_ga958df9e667d4516791537c988fb01999}{bitmap\_clear\_bit}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap,\ \textcolor{keywordtype}{size\_t}\ idx)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Clear\ the\ bit\ by\ ANDing\ with\ the\ negation\ of\ the\ bit\ mask}}
\DoxyCodeLine{\ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[idx\ /\ 8]\ \&=\ \string~(1\ <<\ (idx\ \%\ 8));}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{group__iz__bitmap_gad0afb1000bb11c5aca082e45f813ded2}{bitmap\_set\_all}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ memset(bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}},\ 0xFF,\ (bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aca2dd3fb24d74ee6b53ac400c83fe673}{size}}\ +\ 7)\ /\ 8);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{group__iz__bitmap_ga978e786c92f2cd76110175a6f1c95973}{bitmap\_clear\_all}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ memset(bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}},\ 0x00,\ (bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aca2dd3fb24d74ee6b53ac400c83fe673}{size}}\ +\ 7)\ /\ 8);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{group__iz__bitmap_ga8589bfd273ccc48de55072eeefd1dd93}{bitmap\_clear\_steps}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap,\ uint64\_t\ step,\ uint64\_t\ start\_idx,\ uint64\_t\ limit)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ assert(step\ >\ 0\ \&\&\ \textcolor{stringliteral}{"{}Step\ must\ be\ positive\ in\ bitmap\_clear\_steps."{}});}
\DoxyCodeLine{\ \ \ \ limit\ =\ \doxymbox{\hyperlink{group__iz__utils_ga3acffbd305ee72dcd4593c0d8af64a4f}{MIN}}(limit,\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aca2dd3fb24d74ee6b53ac400c83fe673}{size}}\ -\/\ 1);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ idx\ =\ start\_idx;\ idx\ <=\ limit;\ idx\ +=\ step)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[idx\ /\ 8]\ \&=\ \string~(1\ <<\ (idx\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{group__iz__bitmap_ga80c50898b0382af34259c599a4b329f7}{bitmap\_clear\_steps\_simd}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap,\ uint64\_t\ step,\ uint64\_t\ start\_idx,\ uint64\_t\ limit)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ assert(step\ >\ 0\ \&\&\ \textcolor{stringliteral}{"{}Step\ must\ be\ positive\ in\ bitmap\_clear\_steps\_simd."{}});}
\DoxyCodeLine{\ \ \ \ limit\ =\ \doxymbox{\hyperlink{group__iz__utils_ga3acffbd305ee72dcd4593c0d8af64a4f}{MIN}}(limit,\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aca2dd3fb24d74ee6b53ac400c83fe673}{size}}\ -\/\ 1);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#ifdef\ \_\_aarch64\_\_}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ NEON\ implementation\ for\ ARM64}}
\DoxyCodeLine{\ \ \ \ uint64\_t\ idx\ =\ start\_idx;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Process\ 4\ steps\ at\ a\ time}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Condition:\ idx\ +\ 3*step\ <=\ limit}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (limit\ >=\ 3\ *\ step\ \&\&\ idx\ <=\ limit\ -\/\ 3\ *\ step)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ uint64x2\_t\ v\_step2\ =\ vdupq\_n\_u64(2\ *\ step);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ uint64x2\_t\ v\_step4\ =\ vdupq\_n\_u64(4\ *\ step);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ indices:\ [idx,\ idx+step]\ and\ [idx+2step,\ idx+3step]}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ uint64x2\_t\ v\_idx\_01\ =\ vdupq\_n\_u64(idx);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ v\_idx\_01\ =\ vsetq\_lane\_u64(idx\ +\ step,\ v\_idx\_01,\ 1);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ uint64x2\_t\ v\_idx\_23\ =\ vaddq\_u64(v\_idx\_01,\ v\_step2);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (idx\ <=\ limit\ -\/\ 3\ *\ step)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Extract\ indices\ and\ perform\ operations}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note:\ NEON\ doesn't\ have\ efficient\ scatter\ for\ bytes,\ so\ we\ extract\ and\ do\ scalar\ stores}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ i0\ =\ vgetq\_lane\_u64(v\_idx\_01,\ 0);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ i1\ =\ vgetq\_lane\_u64(v\_idx\_01,\ 1);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ i2\ =\ vgetq\_lane\_u64(v\_idx\_23,\ 0);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ i3\ =\ vgetq\_lane\_u64(v\_idx\_23,\ 1);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[i0\ /\ 8]\ \&=\ \string~(1\ <<\ (i0\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[i1\ /\ 8]\ \&=\ \string~(1\ <<\ (i1\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[i2\ /\ 8]\ \&=\ \string~(1\ <<\ (i2\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[i3\ /\ 8]\ \&=\ \string~(1\ <<\ (i3\ \%\ 8));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Advance\ indices}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ v\_idx\_01\ =\ vaddq\_u64(v\_idx\_01,\ v\_step4);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ v\_idx\_23\ =\ vaddq\_u64(v\_idx\_23,\ v\_step4);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ idx\ +=\ 4\ *\ step;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Handle\ remaining\ steps}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (;\ idx\ <=\ limit;\ idx\ +=\ step)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[idx\ /\ 8]\ \&=\ \string~(1\ <<\ (idx\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#elif\ defined(\_\_AVX2\_\_)}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ AVX2\ implementation\ for\ x86\_64}}
\DoxyCodeLine{\ \ \ \ uint64\_t\ idx\ =\ start\_idx;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Process\ 4\ steps\ at\ a\ time}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (limit\ >=\ 3\ *\ step\ \&\&\ idx\ <=\ limit\ -\/\ 3\ *\ step)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_\_m256i\ v\_step4\ =\ \_mm256\_set1\_epi64x(4\ *\ step);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ indices:\ [idx,\ idx+step,\ idx+2step,\ idx+3step]}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note:\ \_mm256\_set\_epi64x\ takes\ arguments\ in\ reverse\ order\ (e3,\ e2,\ e1,\ e0)}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_\_m256i\ v\_idx\ =\ \_mm256\_set\_epi64x(idx\ +\ 3\ *\ step,\ idx\ +\ 2\ *\ step,\ idx\ +\ step,\ idx);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (idx\ <=\ limit\ -\/\ 3\ *\ step)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Extract\ indices}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ i0\ =\ \_mm256\_extract\_epi64(v\_idx,\ 0);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ i1\ =\ \_mm256\_extract\_epi64(v\_idx,\ 1);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ i2\ =\ \_mm256\_extract\_epi64(v\_idx,\ 2);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ i3\ =\ \_mm256\_extract\_epi64(v\_idx,\ 3);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[i0\ /\ 8]\ \&=\ \string~(1\ <<\ (i0\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[i1\ /\ 8]\ \&=\ \string~(1\ <<\ (i1\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[i2\ /\ 8]\ \&=\ \string~(1\ <<\ (i2\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[i3\ /\ 8]\ \&=\ \string~(1\ <<\ (i3\ \%\ 8));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Advance\ indices}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ v\_idx\ =\ \_mm256\_add\_epi64(v\_idx,\ v\_step4);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ idx\ +=\ 4\ *\ step;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Handle\ remaining\ steps}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (;\ idx\ <=\ limit;\ idx\ +=\ step)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[idx\ /\ 8]\ \&=\ \string~(1\ <<\ (idx\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#elif\ defined(\_\_SSE2\_\_)}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ SSE2\ implementation\ for\ x86\_64}}
\DoxyCodeLine{\ \ \ \ uint64\_t\ idx\ =\ start\_idx;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Process\ 2\ steps\ at\ a\ time}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (limit\ >=\ step\ \&\&\ idx\ <=\ limit\ -\/\ step)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_\_m128i\ v\_step2\ =\ \_mm\_set1\_epi64x(2\ *\ step);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note:\ \_mm\_set\_epi64x\ takes\ arguments\ in\ reverse\ order\ (e1,\ e0)}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \_\_m128i\ v\_idx\ =\ \_mm\_set\_epi64x(idx\ +\ step,\ idx);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (idx\ <=\ limit\ -\/\ step)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Extract\ indices}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \_mm\_cvtsi128\_si64\ extracts\ the\ lower\ 64\ bits\ (element\ 0)}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ i0\ =\ \_mm\_cvtsi128\_si64(v\_idx);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Unpack\ high\ to\ low\ to\ extract\ element\ 1}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ i1\ =\ \_mm\_cvtsi128\_si64(\_mm\_unpackhi\_epi64(v\_idx,\ v\_idx));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[i0\ /\ 8]\ \&=\ \string~(1\ <<\ (i0\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[i1\ /\ 8]\ \&=\ \string~(1\ <<\ (i1\ \%\ 8));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Advance\ indices}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ v\_idx\ =\ \_mm\_add\_epi64(v\_idx,\ v\_step2);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ idx\ +=\ 2\ *\ step;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Handle\ remaining\ steps}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (;\ idx\ <=\ limit;\ idx\ +=\ step)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[idx\ /\ 8]\ \&=\ \string~(1\ <<\ (idx\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Fallback\ to\ scalar\ implementation}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ idx\ =\ start\_idx;\ idx\ <=\ limit;\ idx\ +=\ step)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}[idx\ /\ 8]\ \&=\ \string~(1\ <<\ (idx\ \%\ 8));}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *\doxymbox{\hyperlink{group__iz__bitmap_gabc118534bd59159ed55c509bd1b795e9}{bitmap\_clone}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *src)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ assert(src\ \&\&\ src-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}\ \&\&\ \textcolor{stringliteral}{"{}Invalid\ source\ bitmap\ passed\ to\ bitmap\_clone."{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *dest\ =\ \doxymbox{\hyperlink{group__iz__bitmap_ga165a40f31d911d8939771e064e2b87c1}{bitmap\_init}}(src-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aca2dd3fb24d74ee6b53ac400c83fe673}{size}},\ 0);}
\DoxyCodeLine{\ \ \ \ memcpy(dest-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}},\ src-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}},\ src-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}});}
\DoxyCodeLine{\ \ \ \ memcpy(dest-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aae9a46b0b2a05387d54f18f780632bbe}{sha256}},\ src-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aae9a46b0b2a05387d54f18f780632bbe}{sha256}},\ SHA256\_DIGEST\_LENGTH);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ dest;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{group__iz__bitmap_ga08742aa937df01c455675a8a4884904f}{bitmap\_compute\_hash}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ assert(bitmap\ \&\&\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}\ \&\&\ \textcolor{stringliteral}{"{}Invalid\ bitmap\ passed\ to\ bitmap\_compute\_hash."{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Generate\ SHA-\/256\ hash\ and\ store\ it\ in\ the\ struct}}
\DoxyCodeLine{\ \ \ \ SHA256((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}},\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}},\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aae9a46b0b2a05387d54f18f780632bbe}{sha256}});}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ \doxymbox{\hyperlink{group__iz__bitmap_gab9eee7af8183812a4b2917295466d9f2}{bitmap\_validate\_hash}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ assert(bitmap\ \&\&\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}\ \&\&\ \textcolor{stringliteral}{"{}Invalid\ bitmap"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ correct\_hash[SHA256\_DIGEST\_LENGTH];\ \textcolor{comment}{//\ Buffer\ to\ hold\ the\ computed\ hash}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Generate\ SHA-\/256\ hash\ and\ store\ it\ in\ correct\_hash}}
\DoxyCodeLine{\ \ \ \ SHA256((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}},\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}},\ correct\_hash);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Compare\ actual\_hash\ with\ the\ stored\ hash\ in\ bitmap-\/>sha256}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (memcmp(correct\_hash,\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aae9a46b0b2a05387d54f18f780632bbe}{sha256}},\ SHA256\_DIGEST\_LENGTH)\ ==\ 0)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;\ \textcolor{comment}{//\ SHA-\/256\ match}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}SHA-\/256\ checksum\ validation\ failed."{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;\ \textcolor{comment}{//\ SHA-\/256\ mismatch}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ \doxymbox{\hyperlink{group__iz__bitmap_gafd7cb301fe71bb295c9773e7117aeedc}{bitmap\_fwrite}}(\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap,\ FILE\ *file)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ assert(bitmap\ \&\&\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}}\ \&\&\ \textcolor{stringliteral}{"{}Invalid\ bitmap\ passed\ to\ bitmap\_fwrite."{}});}
\DoxyCodeLine{\ \ \ \ assert(file\ \&\&\ \textcolor{stringliteral}{"{}File\ pointer\ is\ NULL\ in\ bitmap\_fwrite."{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Write\ size}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (fwrite(\&bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aca2dd3fb24d74ee6b53ac400c83fe673}{size}},\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}),\ 1,\ file)\ !=\ 1)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}Failed\ to\ write\ bitmap\ size\ to\ file."{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Write\ data}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (fwrite(bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}},\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}),\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}},\ file)\ !=\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}})}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}Failed\ to\ write\ bitmap\ data\ to\ file."{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Compute\ SHA-\/256\ hash\ if\ not\ already\ computed}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Check\ if\ hash\ is\ all\ zeros\ by\ examining\ all\ bytes}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ hash\_is\_zero\ =\ 1;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ SHA256\_DIGEST\_LENGTH;\ i++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aae9a46b0b2a05387d54f18f780632bbe}{sha256}}[i]\ !=\ 0)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ hash\_is\_zero\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (hash\_is\_zero)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__bitmap_ga08742aa937df01c455675a8a4884904f}{bitmap\_compute\_hash}}(bitmap);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Write\ SHA-\/256\ hash}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (fwrite(bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aae9a46b0b2a05387d54f18f780632bbe}{sha256}},\ 1,\ SHA256\_DIGEST\_LENGTH,\ file)\ !=\ SHA256\_DIGEST\_LENGTH)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}Failed\ to\ write\ SHA-\/256\ hash\ to\ file."{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ 1;\ \textcolor{comment}{//\ Success}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *\doxymbox{\hyperlink{group__iz__bitmap_gaf18da857e5bee7e2b4ed7a2f355143d8}{bitmap\_fread}}(FILE\ *file)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ assert(file\ \&\&\ \textcolor{stringliteral}{"{}File\ pointer\ is\ NULL\ in\ bitmap\_fread."{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Read\ size}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{size\_t}\ size;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (fread(\&size,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}),\ 1,\ file)\ !=\ 1)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}Failed\ to\ read\ bitmap\ size\ from\ file."{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{struct_b_i_t_m_a_p}{BITMAP}}\ *bitmap\ =\ \doxymbox{\hyperlink{group__iz__bitmap_ga165a40f31d911d8939771e064e2b87c1}{bitmap\_init}}(size,\ 0);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (bitmap\ ==\ NULL)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}Failed\ to\ initialize\ bitmap."{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Read\ data\ directly\ into\ the\ already-\/allocated\ buffer}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (fread(bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_a9c6b97f6b598ed49af226c4a93581e94}{data}},\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}),\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}},\ file)\ !=\ bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_ac42dc12965e77a127f9bbea3c37c66ee}{byte\_size}})}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}Failed\ to\ read\ complete\ bitmap\ data\ from\ file."{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__bitmap_ga66cb254c9bf38d7adfe83d723baa2e15}{bitmap\_free}}(\&bitmap);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Read\ SHA-\/256\ hash}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (fread(bitmap-\/>\doxymbox{\hyperlink{struct_b_i_t_m_a_p_aae9a46b0b2a05387d54f18f780632bbe}{sha256}},\ 1,\ SHA256\_DIGEST\_LENGTH,\ file)\ !=\ SHA256\_DIGEST\_LENGTH)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}Failed\ to\ read\ SHA-\/256\ hash\ from\ file."{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__bitmap_ga66cb254c9bf38d7adfe83d723baa2e15}{bitmap\_free}}(\&bitmap);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (!\doxymbox{\hyperlink{group__iz__bitmap_gab9eee7af8183812a4b2917295466d9f2}{bitmap\_validate\_hash}}(bitmap))}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__logger_ga3dc3bd5ec0c013065ffc731ea33271d5}{log\_error}}(\textcolor{stringliteral}{"{}SHA-\/256\ hash\ validation\ failed."{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{group__iz__bitmap_ga66cb254c9bf38d7adfe83d723baa2e15}{bitmap\_free}}(\&bitmap);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ bitmap;}
\DoxyCodeLine{\}}

\end{DoxyCodeInclude}
 